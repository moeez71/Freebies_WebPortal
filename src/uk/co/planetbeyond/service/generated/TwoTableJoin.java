// ______________________________________________________
// Generated by sql2java - http://sql2java.sourceforge.net/
// jdbc driver used at code generation time: com.mysql.jdbc.Driver
//
// Author: Javed Kansi
// ______________________________________________________

package uk.co.planetbeyond.service.generated;


import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.io.Serializable;

import uk.co.planetbeyond.service.generated.BaseGeneratedBean;
import uk.co.planetbeyond.service.generated.ConnectionProfile;
import uk.co.planetbeyond.service.generated.Manager;
import uk.co.planetbeyond.service.generated.exception.DAOException;

/**
 * Use this class to put a join on two tables
 * 
 * @author javed
 * 
 * @param <T>
 *            Left bean of the join
 * @param <V>
 *            Right bean of the join
 */
public class TwoTableJoin<T extends BaseGeneratedBean & JoinHelperInterface, V extends BaseGeneratedBean & JoinHelperInterface> implements Serializable
{
        private static final long serialVersionUID = -5728023647316666208L;
	
	private T bean1;
	private V bean2;

	public TwoTableJoin(T bean1, V bean2)
	{
		this.bean1 = bean1;
		this.bean2 = bean2;
	}

	/**
	 * Puts a join on two tables. The where clause must also contain the join condition between the two tables
	 * 
	 * @param where
	 *            Where clause along with the join condition. This MUST contain the join condition.
	 * @param parameters
	 *            Parameters for the where clause
	 * @return
	 * @throws SQLException
	 */
	public List<TwoTableJoin<T, V>> join(String where, Object[] parameters) throws SQLException
	{
		StringBuffer sql = new StringBuffer();
		sql.append("SELECT ").append(bean1.getBaseManager().getAllFields()).append(",").append(bean2.getBaseManager().getAllFields());
		sql.append(" FROM ").append(bean1.getTableName()).append(", ").append(bean2.getTableName()).append(" ").append(where);

		return executeQuery(parameters, sql);
	}

	/**
	 * Puts a left outer join on two tables.
	 * 
	 * @param on
	 *            The join condition
	 * @param where
	 *            The where clause. This does NOT have to contain the join condition
	 * @param parameters
	 *            Parameters for where clause
	 * @return
	 * @throws SQLException
	 */
	public List<TwoTableJoin<T, V>> leftOuterJoin(String on, String where, Object[] parameters) throws SQLException
	{
		StringBuffer sql = new StringBuffer();
		sql.append("SELECT ").append(bean1.getBaseManager().getAllFields()).append(",").append(bean2.getBaseManager().getAllFields());
		sql.append(" FROM ").append(bean1.getTableName());
		sql.append(" LEFT OUTER JOIN ").append(bean2.getTableName()).append(" ON ").append(on).append(" ").append(where);

		return executeQuery(parameters, sql);
	}

	/**
	 * @param parameters
	 * @param sql
	 * @return
	 * @throws DAOException
	 * @throws SQLException
	 */
	@SuppressWarnings("unchecked")
	private List<TwoTableJoin<T, V>> executeQuery(Object[] parameters, StringBuffer sql) throws DAOException, SQLException
	{
		ConnectionProfile cp = null;
		List<TwoTableJoin<T, V>> retVal = new ArrayList<TwoTableJoin<T, V>>();

		try
		{
			cp = Manager.getInstance().executeQueryByPreparedStatement(sql.toString(), parameters);

			while (cp.getResultSet().next())
			{
				T b1 = (T) bean1.getBaseManager().decodeRowAndReturnBaseBean(cp.getResultSet());
				V b2 = (V) bean2.getBaseManager().decodeRowAndReturnBaseBean(cp.getResultSet());
				retVal.add(new TwoTableJoin<T, V>(b1, b2));
			}

			return retVal;
		}
		finally
		{
			Manager.getInstance().close(cp);
		}
	}

	public T getBean1()
	{
		return bean1;
	}

	public V getBean2()
	{
		return bean2;
	}

	public void setBean1(T bean1)
	{
		this.bean1 = bean1;
	}

	public void setBean2(V bean2)
	{
		this.bean2 = bean2;
	}
}

